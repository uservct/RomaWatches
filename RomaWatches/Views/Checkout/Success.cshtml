@model RomaWatches.Models.Order
@using Microsoft.AspNetCore.Identity
@using RomaWatches.Models
@using System.Globalization
@inject SignInManager<ApplicationUser> SignInManager
@{
    ViewData["Title"] = "ROMA WATCHES - Đặt hàng thành công";
    Layout = null;
    
    // Xác định thông báo dựa trên phương thức thanh toán
    var mainMessage = Model.PaymentMethod switch
    {
        PaymentMethod.COD => "Đơn hàng đã được xác nhận",
        PaymentMethod.InStore => "Đơn hàng đã được xác nhận",
        PaymentMethod.BankTransfer => "Đang chờ xác nhận thanh toán",
        _ => "Đơn hàng đã được xác nhận"
    };
    
    var additionalMessage = Model.PaymentMethod == PaymentMethod.InStore 
        ? "Vui lòng đến cửa hàng để mua sản phẩm" 
        : null;
    
    // Xác định icon hiển thị
    var iconName = Model.PaymentMethod == PaymentMethod.BankTransfer 
        ? "schedule" 
        : "check_circle";
    
    var iconColor = Model.PaymentMethod == PaymentMethod.BankTransfer 
        ? "text-yellow-500" 
        : "text-primary";
    
    // Định dạng mã đơn hàng
    var orderNumber = $"#RW{Model.Id}";
    
    // Định dạng ngày đặt hàng
    var orderDate = Model.CreatedAt.ToString("dd 'Tháng' M, yyyy", new CultureInfo("vi-VN"));
    
    // Hiển thị tên phương thức thanh toán tiếng Việt
    var paymentMethodName = Model.PaymentMethod switch
    {
        PaymentMethod.COD => "Thanh toán khi nhận hàng",
        PaymentMethod.InStore => "Thanh toán tại cửa hàng",
        PaymentMethod.BankTransfer => "Chuyển khoản ngân hàng",
        _ => "Không xác định"
    };
}
<!DOCTYPE html>
<html class="dark" lang="vi">
<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>@ViewData["Title"]</title>
    <!-- Import Tailwind CSS và Fonts -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif:wght@400;700;900&family=Noto+Sans:wght@400;500;700&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    <style>
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
    </style>
    <script id="tailwind-config">
        // Cấu hình Tailwind CSS
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#ecb613",
                        "background-light": "#f8f8f6",
                        "background-dark": "#221d10",
                    },
                    fontFamily: {
                        "display": ["Noto Serif", "Noto Sans", "sans-serif"],
                        "sans": ["Noto Sans", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.25rem",
                        "lg": "0.5rem",
                        "xl": "0.75rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
</head>
<body class="bg-background-light dark:bg-background-dark font-sans">
    <div class="relative flex h-auto min-h-screen w-full flex-col group/design-root overflow-x-hidden">
        @await Html.PartialAsync("_Header")
        <div class="h-[72px]"></div>
        <main class="flex flex-1 justify-center py-12 sm:py-16 md:py-20 px-4 sm:px-6">
            <div class="layout-content-container flex flex-col w-full max-w-4xl flex-1">
                <div class="flex flex-col items-center w-full bg-white dark:bg-[#221d10] border border-neutral-200 dark:border-[#393528] rounded-xl shadow-sm p-6 sm:p-10">
                    <div class="flex flex-col items-center text-center">
                        <!-- Icon trạng thái -->
                        <div class="flex items-center justify-center size-16 bg-primary/20 rounded-full mb-6">
                            <span class="material-symbols-outlined @iconColor !text-4xl">@iconName</span>
                        </div>
                        <!-- Thông báo chính -->
                        <h1 class="text-neutral-900 dark:text-white tracking-tight text-3xl sm:text-4xl font-bold font-display leading-tight">@mainMessage</h1>
                        @if (!string.IsNullOrEmpty(additionalMessage))
                        {
                            <p class="text-neutral-600 dark:text-neutral-300 text-base font-normal leading-normal mt-3 max-w-md">@additionalMessage</p>
                        }
                        else if (Model.PaymentMethod == PaymentMethod.BankTransfer)
                        {
                            <p class="text-neutral-600 dark:text-neutral-300 text-base font-normal leading-normal mt-3 max-w-md">Đơn hàng của bạn đang chờ xác nhận thanh toán. Chúng tôi sẽ xử lý đơn hàng sau khi nhận được thanh toán.</p>
                        }
                        else
                        {
                            <p class="text-neutral-600 dark:text-neutral-300 text-base font-normal leading-normal mt-3 max-w-md">Đơn hàng của bạn đã được xác nhận. Chúng tôi đã gửi một email xác nhận đến địa chỉ email của bạn.</p>
                        }
                    </div>
                    
                    <div class="w-full border-t border-dashed border-neutral-300 dark:border-[#544d3b] my-8 sm:my-10"></div>
                    
                    <!-- Thông tin tóm tắt đơn hàng -->
                    <div class="w-full">
                        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                            <div class="flex flex-col gap-1 rounded-lg bg-neutral-100 dark:bg-[#2c2617] p-4">
                                <p class="text-neutral-500 dark:text-[#b9b29d] font-normal leading-normal">Số đơn hàng</p>
                                <p class="text-neutral-900 dark:text-white font-medium leading-normal">@orderNumber</p>
                            </div>
                            <div class="flex flex-col gap-1 rounded-lg bg-neutral-100 dark:bg-[#2c2617] p-4">
                                <p class="text-neutral-500 dark:text-[#b9b29d] font-normal leading-normal">Ngày đặt</p>
                                <p class="text-neutral-900 dark:text-white font-medium leading-normal">@orderDate</p>
                            </div>
                            <div class="flex flex-col gap-1 rounded-lg bg-neutral-100 dark:bg-[#2c2617] p-4">
                                <p class="text-neutral-500 dark:text-[#b9b29d] font-normal leading-normal">Tổng cộng</p>
                                <p class="text-neutral-900 dark:text-white font-medium leading-normal">@Model.TotalAmount.ToString("N0")₫</p>
                            </div>
                            <div class="flex flex-col gap-1 rounded-lg bg-neutral-100 dark:bg-[#2c2617] p-4">
                                <p class="text-neutral-500 dark:text-[#b9b29d] font-normal leading-normal">Phương thức thanh toán</p>
                                <p class="text-neutral-900 dark:text-white font-medium leading-normal">@paymentMethodName</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="w-full border-t border-dashed border-neutral-300 dark:border-[#544d3b] my-8 sm:my-10"></div>
                    
                    <!-- Chi tiết sản phẩm trong đơn hàng -->
                    <div class="w-full">
                        <h3 class="text-neutral-900 dark:text-white text-lg font-bold font-display leading-tight tracking-[-0.015em] mb-4">Chi tiết đơn hàng</h3>
                        <div class="flex flex-col gap-4">
                            @if (Model.OrderItems != null && Model.OrderItems.Any())
                            {
                                var orderItemsList = Model.OrderItems.ToList();
                                @for (int i = 0; i < orderItemsList.Count; i++)
                                {
                                    var item = orderItemsList[i];
                                    <div class="flex items-center gap-4 @(i < orderItemsList.Count - 1 ? "border-b border-neutral-200 dark:border-[#393528] pb-4" : "")">
                                        <img class="size-20 object-cover rounded-lg bg-neutral-200 dark:bg-neutral-700" 
                                             alt="@(item.Product?.Name ?? "Sản phẩm")" 
                                             src="@(string.IsNullOrEmpty(item.Product?.ImageUrl) ? "https://images.unsplash.com/photo-1523275335684-37898b6baf30" : item.Product.ImageUrl)" />
                                        <div class="flex-1">
                                            <p class="text-neutral-900 dark:text-white text-sm font-semibold leading-normal">@(item.Product?.Name ?? "Sản phẩm không xác định")</p>
                                            <p class="text-neutral-500 dark:text-neutral-400 text-xs leading-normal">Số lượng: @item.Quantity</p>
                                        </div>
                                        <p class="text-neutral-800 dark:text-neutral-200 text-sm font-medium">@((item.Quantity * item.Price).ToString("N0"))₫</p>
                                    </div>
                                }
                            }
                        </div>
                    </div>
                    
                    <!-- Các nút điều hướng -->
                    <div class="w-full mt-10 flex flex-col sm:flex-row items-center justify-center gap-3">
                        <a asp-controller="Product" asp-action="Index" class="flex w-full sm:w-auto min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-11 px-6 bg-primary text-neutral-900 text-sm font-bold leading-normal tracking-[0.015em] hover:bg-primary/90 transition-colors">
                            <span class="truncate">Tiếp tục mua sắm</span>
                        </a>
                        <a asp-controller="Order" asp-action="Index" class="flex w-full sm:w-auto min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-11 px-6 bg-transparent text-neutral-800 dark:text-white text-sm font-bold leading-normal tracking-[0.015em] border border-neutral-300 dark:border-[#393528] hover:bg-neutral-100 dark:hover:bg-[#393528] transition-colors">
                            <span class="truncate">Xem lịch sử đơn hàng</span>
                        </a>
                    </div>
                </div>
            </div>
        </main>
        @await Html.PartialAsync("_Footer")
    </div>
    @await Html.PartialAsync("_CommonScripts")
</body>
</html>

