@using Microsoft.AspNetCore.Identity
@using RomaWatches.Models
@inject SignInManager<ApplicationUser> SignInManager
@inject UserManager<ApplicationUser> UserManager
@{
    var user = await UserManager.GetUserAsync(User);
    var currentController = ViewContext.RouteData.Values["controller"]?.ToString();
    var currentAction = ViewContext.RouteData.Values["action"]?.ToString();
}
<header class="fixed top-0 left-0 right-0 z-50 flex items-center justify-between whitespace-nowrap border-b border-solid border-white/20 px-4 sm:px-6 md:px-8 lg:px-12 xl:px-16 py-4 font-display w-full bg-background-dark/80 backdrop-blur-sm">
    <div class="flex items-center gap-12">
        <a class="flex items-center gap-2 text-white" asp-controller="Home" asp-action="Index">
            <span class="material-symbols-outlined text-3xl">watch</span>
            <div class="flex flex-col">
                <h2 class="text-white text-xl font-bold uppercase tracking-widest">ROMA</h2>
                <span class="text-xs text-white/70 tracking-[0.2em]">WATCHES</span>
            </div>
        </a>
        <nav class="hidden md:flex items-center gap-8">
            <a class="text-white/80 hover:text-white text-sm font-medium uppercase tracking-wider transition-colors @(currentController == "Home" && currentAction == "Index" ? "!text-white" : "")" asp-controller="Home" asp-action="Index">Trang chủ</a>
            <a class="text-white/80 hover:text-white text-sm font-medium uppercase tracking-wider transition-colors @(currentController == "About" ? "!text-white" : "")" asp-controller="About" asp-action="Index">Giới thiệu</a>
            <a class="text-white/80 hover:text-white text-sm font-medium uppercase tracking-wider transition-colors @(currentController == "Product" ? "!text-white" : "")" asp-controller="Product" asp-action="Index">Cửa hàng</a>
            <a class="text-white/80 hover:text-white text-sm font-medium uppercase tracking-wider transition-colors" href="#">Tin tức</a>
            <a class="text-white/80 hover:text-white text-sm font-medium uppercase tracking-wider transition-colors" href="#">Liên hệ</a>
        </nav>
    </div>
    <div class="flex flex-1 justify-end gap-4 md:gap-6">
        <div class="relative flex items-center gap-4">
            <!-- Search Bar -->
            <div id="searchContainer" class="hidden absolute right-0 top-full mt-2 w-80 md:w-96 z-50">
                <form id="searchForm" onsubmit="handleSearch(event)" class="flex items-center gap-2 bg-background-dark border border-white/20 rounded-lg px-4 py-2 shadow-lg">
                    <input 
                        type="text" 
                        id="searchInput" 
                        name="searchQuery"
                        placeholder="Tìm kiếm tên hoặc hãng đồng hồ" 
                        class="flex-1 bg-transparent text-white placeholder:text-white/50 outline-none text-sm"
                        autocomplete="off"
                    />
                    <button type="submit" class="text-white hover:text-white/70 transition-colors">
                        <span class="material-symbols-outlined text-xl">search</span>
                    </button>
                    <button type="button" onclick="toggleSearch()" class="text-white hover:text-white/70 transition-colors">
                        <span class="material-symbols-outlined text-xl">close</span>
                    </button>
                </form>
            </div>
            <button onclick="toggleSearch()" class="flex max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 text-white hover:text-white/70 transition-colors gap-2 text-sm font-bold leading-normal tracking-[0.015em] min-w-0 px-2.5">
                <span class="material-symbols-outlined text-2xl">search</span>
            </button>
        </div>
        <div class="flex gap-4">
            @if (SignInManager.IsSignedIn(User) && user != null)
            {
                <div class="relative group">
                    <button class="relative flex max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 text-white hover:text-white/70 transition-colors gap-2 text-sm font-bold leading-normal tracking-[0.015em] min-w-0 px-2.5">
                        <span class="material-symbols-outlined text-2xl">person</span>
                        <span class="absolute -bottom-0.5 -right-0.5 flex items-center justify-center w-4 h-4 bg-primary rounded-full">
                            <span class="material-symbols-outlined text-xs text-background-dark">check</span>
                        </span>
                    </button>
                    <div class="absolute right-0 mt-2 w-48 bg-[#1d190e] border border-white/20 rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
                        <div class="py-2">
                            <div class="px-4 py-2 text-white text-sm border-b border-white/10">
                                <p class="font-semibold">@user.FirstName @user.LastName</p>
                                <p class="text-gray-400 text-xs">@user.Email</p>
                            </div>
                            <a href="#" class="block px-4 py-2 text-white/80 hover:text-white hover:bg-white/10 text-sm transition-colors">Trang cá nhân</a>
                            <a href="#" class="block px-4 py-2 text-white/80 hover:text-white hover:bg-white/10 text-sm transition-colors">Đơn hàng</a>
                            @if (user.Role == "admin")
                            {
                                <a asp-controller="Admin" asp-action="Dashboard" class="block px-4 py-2 text-white/80 hover:text-white hover:bg-white/10 text-sm transition-colors">Admin Panel</a>
                            }
                            <form asp-controller="Account" asp-action="Logout" method="post" class="border-t border-white/10 mt-2">
                                @Html.AntiForgeryToken()
                                <button type="submit" class="w-full text-left px-4 py-2 text-white/80 hover:text-white hover:bg-white/10 text-sm transition-colors">Đăng xuất</button>
                            </form>
                        </div>
                    </div>
                </div>
            }
            else
            {
                <button onclick="openLoginModal()" class="flex max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 text-white hover:text-white/70 transition-colors gap-2 text-sm font-bold leading-normal tracking-[0.015em] min-w-0 px-2.5">
                    <span class="material-symbols-outlined text-2xl">person</span>
                </button>
            }
            <button class="relative flex max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 text-white hover:text-white/70 transition-colors gap-2 text-sm font-bold leading-normal tracking-[0.015em] min-w-0 px-2.5">
                <span class="material-symbols-outlined text-2xl">shopping_bag</span>
                <span class="absolute top-1 right-0 flex h-4 w-4 items-center justify-center rounded-full bg-red-600 text-xs font-bold text-white">0</span>
            </button>
        </div>
    </div>
</header>

